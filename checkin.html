<head>
    <title>checkin</title>
</head>

<body>
    {{yield}}
</body>

<template name="main">
    <div class="navbar navbar-inverse">
        <div class="navbar-inner">
            <a class="brand" href="#">Checkin</a>
            <div class="pull-right">
                {{#if currentUser}}
                {{#if currentUser.username}}
                <span class="label label-info">{{currentUser.username}}</span>
                {{/if}}
                <button id="log-out-btn" class="btn">Log out</button>
                {{else}}
                <a href="#create-user-modal" role="button" class="btn" data-toggle="modal">Create user</a>
                <a href="#sign-in-modal" role="button" class="btn" data-toggle="modal">Sign in</a>
                {{/if}}
            </div>

        </div>
    </div>
    <div class="container">
    <div class="row">
        {{#each teamColumns}}
        <div class="span3">
            {{#each this}}
            <div class="thumbnail">
                {{> teamHeader}}
                {{> teamLatest}}
            </div>
            {{/each}}
        </div>
        {{/each}}
    </div>
    <hr>

    <div class="show-days-option">
        {{#if showDays}}
        <button id="show-days-no" class="btn btn-default btn-mini"><i class="icon-chevron-up"></i> Hide history</button>
        {{else}}
        <button id="show-days-yes" class="btn btn-default btn-mini"><i class="icon-chevron-down"></i> Show history</button>
        {{/if}}
    </div>

    {{#if showDays}}
    {{#each days}}
    {{> day}}
    {{/each}}
    {{/if}}

    <div id="verify-email-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false" style="color: black">
        <div class="modal-header">
            <h3>Email verified!</h3>
        </div>
        <div class="modal-body">
            <form class="form-horizontal">
                <div class="control-group">
                    <input id="password-input" type="password" placeholder="Choose a password">
                </div>
                <button id="create-password" class="btn btn-primary">Done</button>
            </form>
            <p></p>
        </div>
    </div>

    <div id="create-user-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true" style="color: black">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3>You're all like, sign me up!</h3>
        </div>
        <div class="modal-body">
            <p>Enter your email address and we'll <strike>spam you mercilessly</strike> send you a message to guide you through the process.</p>
            <form class="form-horizontal">
                <div class="control-group">
                    {{#if restrictedDomain}}
                    <input id="create-user-email" type="text" placeholder="example"> @{{restrictedDomain}}
                    {{else}}
                    <input id="create-user-email" type="text" placeholder="example@internet.web">
                    {{/if}}
                </div>
                <button id="create-user" class="btn btn-primary">Let's do this</button>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Actually, I'm not sure I'm cool enough</button>
        </div>
    </div>

    <div id="sign-in-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true" style="color: black">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3>Sign in</h3>
        </div>
        <div class="modal-body">
            <form class="form-horizontal">
                <div class="control-group">
                    {{#if restrictedDomain}}
                    <input id="sign-in-email" type="text" placeholder="Email address"> @{{restrictedDomain}}
                    {{else}}
                    <input id="sign-in-email" type="text" placeholder="Email address">
                    {{/if}}
                </div>
                <div class="control-group">
                    <input id="sign-in-password" type="password" placeholder="Password">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button id="sign-in-button" class="btn btn-primary">Sign in</button>
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </div>
    </div>
</template>

<template name="teamHeader">
    <div class="thumbnail-head">
        <span class="label {{timeLabelClass}}">{{timeLabel}}</span>
        {{#unless edit}}
        {{#if alreadyCheckedIn}}
        <button class="add-checkin btn btn-mini" title="Edit today's checkin"><i class="icon-edit"></i></button>
        {{else}}
        <button class="same-checkin btn btn-mini" title="Lazy Button&#8482;"><i class="icon-retweet"></i></button>
        <button class="add-checkin btn btn-mini" title="Create new checkin"><i class="icon-pencil"></i></button>
        {{/if}}
        {{/unless}}
        <h3>{{name}}</h3>
    </div>
</template>

<template name="day">
    <div class="row">
        <h4>{{ dateString }}</h4>

        <div class="flow">
            {{#each teamDays}}
            {{> teamDay}}
            {{/each}}
        </div>
    </div>
</template>

<template name="teamDay">
    <div class="thumbnail flow-item">
        <div class="thumbnail-head">
            <h4>{{team.name}}</h4>
        </div>
        <div class="thumbnail-body">
            {{#each checkins}}
            <div class="checkin">
                {{#markdown}}{{description}}{{/markdown}}
            </div>
            {{/each}}
        </div>
    </div>
</template>

<template name="teamLatest">
    <div class="thumbnail-body">
        {{#if edit}}
        <div>
            <textarea id="text" cols="30" rows="5">{{checkin.description}}</textarea>
        </div>
        <div class="preview">
            {{#markdown}}{{preview}}{{/markdown}}
        </div>
        <div>
            <button class="btn btn-primary btn-small" id="save-new-checkin">Add</button>
            <button class="btn btn-small" id="cancel-new-checkin">Cancel</button>
        </div>
        {{else}}
        {{#markdown}}{{checkin.description}}{{/markdown}}
        {{/if}}
    </div>
</template>
